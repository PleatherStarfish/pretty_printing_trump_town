<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>Timeline with Integers</title>
  <meta charset="utf-8" />
  <style>
  div.tooltip {
    position: absolute;
    text-align: left;
    padding: 20px;
    font: 18px sans-serif;
    background: rgb(229, 229, 229, 0.8);
    border: 0px;
    pointer-events: none;
    width: 200px;

    font-family: Arial;
    font-size: 13px;

    -moz-border-radius: 5px;
    border-radius: 5px;
}
line {
  fill: none;
  stroke: #000;
  stroke-width: 1px;
}
#label {
  font-family: Arial;
  font-size: 25px;
  opacity: 0.5;
  /* transform: translate(100px, 100px); */
  /* -ms-transform: rotate(-40deg); /* IE 9 */
  /* -webkit-transform: rotate(-40deg); /* Safari */
  /* transform: rotate(-40deg); */
}

  </style>

</head>

<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.16/d3.min.js" charset="utf-8" type="text/javascript"></script>
<script src="data.js" type="text/javascript"></script>
<script src="data_old.js" type="text/javascript"></script>
<script src="organization.js" type="text/javascript"></script>
<script src="staffer_org.js" type="text/javascript"></script>

<body>

  <script>


  const w                   = 1850;
  const h                   = 16000;
  const padding             = .5;
  const minBarThickness     = 2;
  const textYesNo           = false;
  const lhPadding           = 0;
  const agencyPadding       = 20;
  const dateformat = d3.time.format("%b, %y");
  let y_index = 15;
  let staffer_line_xy       = {};


  function handleMouseOut(d, i) {
      // Use D3 to select element, change color back to normal
      d3.select(this)
        .attr({fill: !d.start_date ? "#eaeaea" : "#ffccff"})
        .attr({height: 2});
    }

  function handleMouseOver(d, i) {
      d3.select(this)
        .attr({fill: "#ff00ff"})
        .attr({height: 2});

    }

  function barCluster(agency) {

    let agency_cluster = svgSelection.selectAll(null)
       .data([agency])
       .enter()
       .append("g");

    // if (textYesNo) {
    // agency_cluster.append("text")
    //    .attr("x", 50)
    //    .attr("y", y_index * (minBarThickness + padding))
    //    .text((d) => agency.agency_name);
    //  };

    for (let position in agency["positions"]) {

      let positions_cluster = svgSelection.selectAll(null)
         .data([position])
         .enter()
         .append("g");

      // if (textYesNo) {
      // positions_cluster.append("text")
      //        .attr("x", 300)
      //        .attr("y", y_index * (minBarThickness + padding))
      //        .text((d) => position);
      // };

        for (let person in agency["positions"][position]){

          const one_person = agency["positions"][position][person];

          const start_x = linearScale(one_person.start_date ? new Date(one_person.start_date) : new Date("2017-1-19"));
          const end_x = linearScale(one_person.end_date ? new Date(one_person.end_date) : new Date("2018-10-15"));

          let bars = positions_cluster.selectAll(null)
             .data([one_person])
             .enter()
             .append("g");

          bars.append("rect")
             .attr("x", start_x + lhPadding)
             .attr("y", y_index * (minBarThickness + padding))
             .attr("height", minBarThickness)
             .attr("width", end_x - start_x)
             .attr("fill", start_x == linearScale(new Date("2017-1-19")) ? "#eaeaea" : "#ffccff")
             .on("mouseover", handleMouseOver)
             .on("mouseout", handleMouseOut);

          bars.on("mouseover", (d, i) => {tooltip.html("<strong><span style='color:black'>" + d.name + "</span></strong><br>"
          + position + " (" + agency["agency_name"] + ") " + "<br>" + d.start_date + " - " + d.end_date
            );
          tooltip.style("visibility", "visible")
                      .transition()
                      .delay(0)
                      .duration(400)
                      .style("opacity",1);})
      	      .on("mousemove", (d, i) => {return tooltip.style("top", (event.pageY-10)+"px").style("left",(event.pageX+10)+"px");})
              .on("mouseout", (d, i) => {return tooltip.style("visibility", "hidden").transition().delay(0).duration(300).style("opacity",0);})

          // if (textYesNo) {
          // bars.append("text")
          //     .attr("x", end_x)
          //     .attr("y", y_index * (minBarThickness + padding))
          //     .text((d) => d.name);
          // }

          // bars.append("text")
          //     .attr("x", 500)
          //     .attr("y", 500)
          //     .attr('id', "label")
          //     .text("test");

          staffer_line_xy[one_person.staffer_id] = y_index * (minBarThickness + padding);

          y_index += 1;
        }
      y_index += 1;
    }
    y_index += agencyPadding
  }

let bodySelection = d3.select("body");

let svgSelection = bodySelection
                   .append("svg")
                   .attr("width", w)
                   .attr("height", h)

  // const svg = d3.select("body")
  //               .append("svg")
  //               .attr("width", w)
  //               .attr("height", h);

  const linearScale = d3.time.scale()
                .domain([new Date("2017-1-1"), new Date("2018-1-1")])
                .range([0, 1150]);

  let tooltip = d3.select("body")
              	.append("div")
                .attr("class", "tooltip")
              	.style("position", "absolute")
              	.style("z-index", "10")
              	.style("visibility", "hidden")
                .style("opacity",0)
                .text("test");

    // svgSelection.append("text")
    //            .attr("x", 500)
    //            .attr("y", 500)
    //            .attr('id', "label")
    //            .text("test")

 // let agency_cluster = svg.select(null)
 // let positions_cluster = svg.select(null)
 // let bars = svg.select(null)

  Object.entries(frog).forEach(
    ([key, value]) => barCluster(value)
  );

  const inauguration = linearScale(new Date("2017-1-20")) + lhPadding;
  const flynn = linearScale(new Date("2017-2-13")) + lhPadding;
  const comey = linearScale(new Date("2017-5-9")) + lhPadding;
  const bannon = linearScale(new Date("2017-8-18")) + lhPadding;
  const tillerson = linearScale(new Date("2018-3-31")) + lhPadding;
  const manafort = linearScale(new Date("2017-10-30")) + lhPadding;

  // Inauguration
  svgSelection.append("text")
             .attr("x", inauguration - 5)
             .attr("y", 530)
             .attr('id', "label")
             .attr("transform", "rotate(-90, "+ (inauguration - 5) + ", 530)")
             .text("Inauguration of Donald Trump (Jan. 20, 2017)");
  svgSelection.append("line")
    .style("stroke-dasharray", ("10, 10"))
    .attr("x1", inauguration)
    .attr("y1", 25)
    .attr("x2", inauguration)
    .attr("y2", 16000);

  // Mike Flynn
  svgSelection.append("text")
             .attr("x", flynn - 5)
             .attr("y", 695)
             .attr('id', "label")
             .attr("transform", "rotate(-90, "+ (flynn - 5) + ", 695)")
             .text("National Security Advisor Mike Flynn resigns (Feb. 13, 2017)");
  svgSelection.append("line")          // attach a line
    .style("stroke-dasharray", ("10, 10"))
    .attr("x1", flynn)
    .attr("y1", 25)
    .attr("x2", flynn)
    .attr("y2", 16000);

    svgSelection.append("text")
               .attr("x", comey - 5)
               .attr("y", 675)
               .attr('id', "label")
               .attr("transform", "rotate(-90, "+ (comey - 5) + ", 675)")
               .text("Trump dismisses FBI director James Comey (May 9, 2017)");
    svgSelection.append("line")
      .style("stroke-dasharray", ("10, 10"))
      .attr("x1", comey)
      .attr("y1", 25)
      .attr("x2", comey)
      .attr("y2", 16000);

    svgSelection.append("text")
               .attr("x", bannon - 5)
               .attr("y", 555)
               .attr('id', "label")
               .attr("transform", "rotate(-90, "+ (bannon - 5) + ", 555)")
               .text("Trump dismisses Steve Bannon (Aug. 18, 2017)");
    svgSelection.append("line")
      .style("stroke-dasharray", ("10, 10"))
      .attr("x1", bannon)
      .attr("y1", 25)
      .attr("x2", bannon)
      .attr("y2", 16000);

    svgSelection.append("text")
               .attr("x", manafort - 5)
               .attr("y", 858)
               .attr('id', "label")
               .attr("transform", "rotate(-90, "+ (manafort - 5) + ", 858)")
               .text("Paul Manafort arrested for conspiracy against United States (Oct. 30, 2017)");
    svgSelection.append("line")
      .style("stroke-dasharray", ("10, 10"))
      .attr("x1", manafort)
      .attr("y1", 25)
      .attr("x2", manafort)
      .attr("y2", 16000);

    svgSelection.append("text")
               .attr("x", tillerson - 5)
               .attr("y", 540)
               .attr('id', "label")
               .attr("transform", "rotate(-90, "+ (tillerson - 5) + ", 540)")
               .text("Trump dismisses Rex Tillerson (Mar. 31, 2018)");
    svgSelection.append("line")
      .style("stroke-dasharray", ("10, 10"))
      .attr("x1", tillerson)
      .attr("y1", 25)
      .attr("x2", tillerson)
      .attr("y2", 16000);

  </script>

</body>
</html>
