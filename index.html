<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>Timeline with Integers</title>
  <meta charset="utf-8" />
  <link href="https://fonts.googleapis.com/css?family=Lora" rel="stylesheet">
  <link href="index.css" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.16/d3.min.js" charset="utf-8" type="text/javascript"></script>
  <script src="data.js" type="text/javascript"></script>
  <script src="data_old.js" type="text/javascript"></script>
  <script src="organization.js" type="text/javascript"></script>
  <script src="staffer_org.js" type="text/javascript"></script>

</head>

<body>

  <header>

    <h1 id=title>Pretty Printing Trump Town</h1><br>
    <h2 id=subtitle>Tracking the career history of 2,724 White House staffers, cabinet members, and<br>
      political appointees through one ProPublica dataset</h2>
    <div class="slidecontainer">
      <p class="zoom">Zoom: <span id="demo"></span>%</p>
      <input type="range" min="1" max="100" value="70" class="slider" id="myRange">
    </div>

  </header>

  <script>

  const w                   = 3700;
  const h                   = 11300;
  const padding             = .5;
  const minBarThickness     = 2;
  const textYesNo           = false;
  const agencyPadding       = 20;
  const dateformat          = d3.time.format("%b, %y");
  const lhPadding           = 700;
  let y_index = 15;
  let staffer_line_xy       = {};

  const linearScale = d3.time.scale()
          .domain([new Date("2017-1-1"), new Date("2018-12-1")])
          .range([0, 2500]);

  function gradeLevel( salary ) {
    if (salary[0] == salary[1]) {
      return "$"+salary[0]
    }
    else if (!salary[0] || !salary[0]) {
      return "no information on salary"
    }
    else {
      return "$"+salary[0] + " - " + "$"+salary[1]
    }

  }

  function handleMouseOut(d, i) {
      // Use D3 to select element, change color back to normal
      d3.select(this)
        .attr({fill: !d.start_date ? "#eaeaea" : "#ffccff"})
        .attr({height: 2});
    }

  function handleMouseOver(d, i) {
      d3.select(this)
        .attr({fill: "#ff00ff"})
        .attr({height: 2});

    }

  function barCluster(agency) {

    let agency_cluster = svgSelection.selectAll(null)
       .data([agency])
       .enter()
       .append("g");


    agency_cluster.append("text")
       .attr("x", 2400 + lhPadding)
       .attr("y", y_index * (minBarThickness + padding) + 5)
       .attr('id', "agency")
       .text((d) => agency.agency_name);

    const agencyLineLength = (y_index * (minBarThickness + padding))

    for (let position in agency["positions"]) {

      let positions_cluster = svgSelection.selectAll(null)
         .data([position])
         .enter()
         .append("g");

        for (let person in agency["positions"][position]){

          const one_person = agency["positions"][position][person];
          staffer_line_xy[one_person.staffer_id] = y_index;
          // console.log(one_person.linkedin_url)

          const start_x = linearScale(one_person.start_date ? new Date(one_person.start_date) : new Date("2017-1-19"));
          const end_x = linearScale(one_person.end_date ? new Date(one_person.end_date) : new Date("2018-10-15"));

          let bars = positions_cluster.selectAll(null)
             .data([one_person])
             .enter()
             .append("g");

          bars.append("a")
             .attr("xlink:href", function(d) {return d.linkedin_url})
             .append("rect")
             .attr("x", start_x + lhPadding)
             .attr("y", y_index * (minBarThickness + padding))
             .attr("height", minBarThickness)
             .attr("width", end_x - start_x)
             .attr("fill", (d, i) => d.staffer_id == 1032 ?
                             "#ff00ff"
                            :
                              start_x == linearScale(new Date("2017-1-19")) ? "#eaeaea" : "#ffccff"
                            )
             .on("mouseover", handleMouseOver)
             .on("mouseout", handleMouseOut);

          bars.on("mouseover", (d, i) => {tooltip.html("<div class=tip><strong><span id=name>" + d.name + "</span></strong><br>"
          + position + " (" + agency["agency_name"] + ") " + "<br><br>" + gradeLevel(d.grade_level) + "<br><br>" + (d.start_date ? d.start_date : "unknown") + " - " + (d.end_date ? d.end_date : "present") + "<br><br>" +
          d.linkedin_url + "</div>"
            );
          tooltip.style("visibility", "visible")
                      .transition()
                      .delay(0)
                      .duration(400)
                      .style("opacity",1);})
      	      .on("mousemove", (d, i) => {return tooltip.style("top", (event.pageY-10)+"px").style("left",(event.pageX+10)+"px");})
              .on("mouseout", (d, i) => {return tooltip.style("visibility", "hidden").transition().delay(0).duration(300).style("opacity",0);})

          staffer_line_xy[one_person.staffer_id] = y_index * (minBarThickness + padding);

          y_index += 1;
        }
      y_index += 1;
    }
    svgSelection.append("line")
      .attr("x1", 2380 + lhPadding)
      .attr("y1", agencyLineLength)
      .attr("x2", 2380 + lhPadding)
      .attr("y2", y_index);

    y_index += agencyPadding
  }

let bodySelection = d3.select("body");

let svgSelection = bodySelection
                   .append("main")
                   .attr("width", w)
                   .attr("height", h)
                   .attr('id', "container")
                   .attr('class', "svg-container")
                   .append("svg")
                   .attr("width", w)
                   .attr("height", h)
                   .attr("preserveAspectRatio", "xMinYMin meet")
                   .attr("viewBox", `0 0 ${w} ${h}`)
                   .classed("svg-content", true);

  // const svg = d3.select("body")
  //               .append("svg")
  //               .attr("width", w)
  //               .attr("height", h);


 //    svgSelection.append("text")
 //               .attr("x", 500)
 //               .attr("y", 500)
 //               .attr('id', "label")
 //               .text("test")
 //
 // let agency_cluster = svg.select(null)
 // let positions_cluster = svg.select(null)
 // let bars = svg.select(null)

  Object.entries(frog).forEach(
    ([key, value]) => barCluster(value)
  );

  let tooltip = d3.select("body")
          .append("div")
          .attr("class", "tooltip")
          .style("position", "absolute")
          .style("z-index", "10")
          .style("visibility", "hidden")
          .style("opacity",0)
          .text("test");


  </script>

  <script type="text/javascript" src="event_lines.js"></script>
  <script type="text/javascript" src="slider.js"></script>
</body>
</html>
